import { useRef, useCallback } from 'react'
import gsap from 'gsap'
import { MorphSVGPlugin } from 'gsap/MorphSVGPlugin'
import cn from 'classnames'

gsap.registerPlugin(MorphSVGPlugin)

/** Initial viewBox (140×111) - matches original paths */
const VIEWBOX_INITIAL = '0 0 140 111'

/** Final viewBox (230×180) - matches final paths */
const VIEWBOX_FINAL = '0 0 230 180'

/** Original paths (140×111 space) - first 14 paths */
const ORIGINAL_PATHS = [
  'M91.8866 19.7355C97.7125 17.5669 101.439 21.9266 104.069 26.5501C109.866 36.753 114.693 66.2155 114.981 78.3891C115.144 85.2724 114.223 91.7274 105.753 92.0864C97.679 92.4306 92.6996 82.6293 86.3939 79.4032C81.68 76.993 76.6986 80.6838 72.0977 82.0995C67.1394 83.6257 60.9195 84.2425 56.3917 86.6659C50.725 89.6985 48.741 96.7207 44.3359 101.138C34.3581 111.141 28.6882 107.53 24.3786 95.6331C20.069 83.7357 16.0213 64.1148 16.9456 51.4858C17.525 43.5679 19.0187 38.8851 27.9702 38.5935C33.3665 38.4188 34.2533 40.5872 38.532 41.9632C47.0445 44.7014 70.2919 38.3321 77.6613 33.0752C82.9559 29.3021 85.6532 22.0516 91.8859 19.7319L91.8866 19.7355ZM37.3415 43.5134C36.9568 43.1852 31.9112 40.842 31.2533 40.6992C27.6074 39.9114 22.2485 40.4233 20.2864 44.0403C14.6609 54.4174 21.7711 81.2052 25.5201 92.0363C28.5468 100.773 31.2855 109.641 41.4492 101.108C47.0248 96.4278 48.4961 88.8046 54.6877 85.237C59.5768 82.4189 66.555 81.5302 72.0167 79.8755C79.766 77.5252 82.8056 73.6024 90.3316 79.5844C95.6826 83.8382 100.446 92.3618 108.562 89.7383C109.895 89.3083 111.063 88.3905 111.82 87.219C115.052 82.2158 111.866 65.5114 110.899 59.4721C109.427 50.2645 106.38 27.0522 97.7123 22.0093C90.1926 17.6345 84.2904 31.9966 78.9122 34.6914C79.6353 40.5693 79.1592 50.8406 74.0217 54.6893C69.8004 57.8512 54.4282 61.7911 49.2627 61.0384C45.6349 60.5113 42.3197 57.1828 40.8546 53.9555C39.8661 51.7771 38.5871 44.5715 37.3371 43.5105L37.3415 43.5134ZM78.5618 35.0838C69.5372 40.8435 58.7657 42.7972 48.2949 44.1884L39.1206 44.3642C41.6551 49.2022 43.1739 56.9682 49.6179 57.6885C55.2263 58.3173 70.0709 54.5567 73.9203 50.256C76.9092 46.9179 76.9862 39.247 78.5581 35.0846L78.5618 35.0838Z',
  'M74.975 60.6241C76.8295 59.7785 81.3598 60.805 82.8971 62.1297C87.8138 66.3602 84.0629 75.0604 77.5327 73.4766C72.2366 72.1912 70.3663 62.7231 74.975 60.6241ZM76.1402 62.6138C72.8472 63.9529 75.4005 72.6244 79.9142 71.0999C82.3667 70.2713 82.8675 67.1678 81.9034 65.0341C81.216 63.5109 77.6014 62.0237 76.1409 62.6174L76.1402 62.6138Z',
  'M55.2813 71.0089C60.754 75.2955 54.6455 83.8132 49.0566 80.6032C45.0595 78.3048 45.1007 69.9825 49.6226 69.3908C50.6915 69.2515 54.461 70.3665 55.2813 71.0089ZM49.6627 71.4123C47.1927 71.9266 47.3732 78.7068 51.0103 79.0904C54.3923 79.445 56.4208 74.9032 53.1154 72.6297C52.6119 72.2834 50.1565 71.3126 49.6627 71.4123Z',
  'M92.6286 34.5747C98.2293 32.2026 98.7306 41.3689 92.449 40.7306C89.1046 40.3913 89.5265 35.8906 92.6286 34.5747ZM94.2242 36.4161L92.1993 37.254L92.4235 38.6486L94.2159 38.1219L94.2234 36.4124L94.2242 36.4161Z',
  'M31.3393 74.1485C28.9784 70.949 29.4365 68.754 33.0852 67.163C35.3524 66.1766 36.5592 66.492 37.0294 69.1428C37.6812 72.8063 34.3214 73.8717 31.3393 74.1485ZM35.0156 68.6113L30.3976 69.9232L31.4136 73.0919L35.2052 71.3916L35.0156 68.6113Z',
  'M87.8791 42.6417L88.5658 42.7941C90.6623 45.3117 90.2944 50.4028 86.0539 49.4058C84.5278 49.0477 83.9583 46.5893 84.2762 45.2575C84.6183 43.8365 86.7327 43.2141 87.8791 42.6417ZM87.6717 44.8627C86.0027 45.0313 85.9238 46.4067 86.3816 47.7427C88.0506 47.5741 88.1295 46.1986 87.6717 44.8627Z',
  'M96.7461 49.0537C96.9585 49.1372 98.0409 51.4192 98.1265 51.919C98.6162 54.7612 96.9374 56.6666 94.0676 56.6067C90.038 56.5207 91.58 48.393 95.7299 51.2963C89.8267 53.5189 96.0874 57.6425 96.2678 52.8956C96.3167 51.6565 94.9805 48.3648 96.7497 49.053L96.7461 49.0537Z',
  'M102.103 46.3097C100.437 48.8099 96.5345 48.0817 96.3117 44.8332C96.2793 44.3687 97.1006 42.0353 97.2825 41.8722C98.8714 40.4521 104.484 42.7344 102.103 46.3097ZM98.3882 43.0926C97.7437 43.9274 97.5001 45.1714 98.3677 45.9153C100.196 47.4838 101.727 43.4024 98.3882 43.0926Z',
  'M28.1986 68.7782C27.7227 69.4985 23.5641 71.3189 22.6897 70.9402C21.8914 70.596 21.5607 67.1549 21.9915 66.3824C22.7496 65.0268 27.1128 63.4599 28.0418 65.7232C28.3075 66.3742 28.5877 68.1979 28.1986 68.7782ZM26.2326 66.3184L23.0397 67.0706L23.1785 69.505C24.6302 69.4186 25.7614 68.6195 26.9873 67.9659L26.2363 66.3177L26.2326 66.3184Z',
  'M27.0099 62.3433C26.5104 60.3073 25.3758 56.2665 28.1358 55.4601C31.2511 54.5512 33.8354 60.4898 30.3966 61.9809C29.2649 62.4738 28.162 62.1412 27.0092 62.3396L27.0099 62.3433ZM27.5711 61.4947C31.9331 61.4408 30.4866 55.5712 28.0225 56.9497C27.1296 57.4479 27.3115 60.5131 27.5711 61.4947Z',
  'M35.8636 64.9857C35.2029 63.5758 34.6376 62.3535 34.9366 60.7574C36.1572 60.9513 35.8942 62.4597 36.1972 63.3137C36.6104 64.4672 39.3567 63.3457 39.9692 62.7701C40.4853 62.2867 40.3022 60.7727 40.0196 60.152C38.6998 59.7331 37.4275 60.4036 36.1868 60.5087C35.636 60.5549 35.0217 60.4377 35.5067 59.8955C37.23 59.5206 40.1733 57.5896 41.1741 60.0758C42.5466 63.4903 38.8951 65.6754 35.8636 64.9857Z',
  'M68.2195 67.5338L68.1118 68.8615C66.6563 69.7836 61.1003 71.5032 60.3093 69.3155C60.0738 68.6622 60.3968 68.7042 60.883 68.4528C63.0932 67.2979 65.8307 67.6526 68.2232 67.5331L68.2195 67.5338Z',
  'M35.9927 51.1732C34.798 52.4371 31.819 45.8545 32.5279 45.1292C33.9986 43.6181 36.786 49.7837 35.9927 51.1732Z',
  'M83.4622 35.2276C84.1949 35.5315 83.8944 39.912 82.0828 39.4507C80.2712 38.9895 81.929 34.5876 83.4622 35.2276Z',
  'M67.6511 72.1446L67.6581 73.2998C60.97 76.2515 61.45 72.076 67.6511 72.1446Z',
] as const

/** Final paths (230×180 space) - 18 paths */
const FINAL_PATHS = [
  'M170.963 48.5274C181.319 48.7199 184.438 57.7541 185.693 66.5277C188.456 85.8855 177.962 134.515 170.979 153.566C167.032 164.339 161.665 173.786 148.312 169.174C135.583 164.78 133.843 146.544 126.035 137.694C120.196 131.08 110.22 133.763 102.222 133.151C93.6025 132.492 83.5818 129.653 75.0824 130.647C64.4452 131.891 57.0838 141.569 47.558 145.73C25.9821 155.153 19.394 146.093 19.9719 125.016C20.5497 103.938 26.2468 71.045 35.3867 52.0269C41.1168 40.1033 46.2905 33.7538 60.3483 38.7641C68.8222 41.7862 68.874 45.6896 74.6687 50.4342C86.1969 59.8745 126.13 64.1848 140.765 60.5307C151.277 57.9111 159.884 48.3148 170.964 48.5212L170.963 48.5274ZM71.8767 52.1114C71.4806 51.3677 65.0869 44.6554 64.1539 44.0325C58.9814 40.5862 50.3598 38.1097 45.1102 42.5208C30.0551 55.1783 24.7332 101.053 23.9368 120.135C23.2985 135.529 22.1337 150.95 43.1001 143.922C54.6014 140.068 61.5346 129.145 73.3121 127.392C82.6127 126.006 93.9751 128.886 103.454 129.653C116.904 130.738 124.011 126.51 132.03 140.378C137.731 150.239 139.916 166.362 154.101 167.247C156.43 167.393 158.802 166.684 160.69 165.329C168.754 159.543 174.008 131.698 176.194 121.743C179.53 106.568 188.97 68.7164 178.608 55.6079C169.618 44.2358 151.702 62.9035 141.718 63.8C139.253 73.3553 132.247 88.9912 121.932 91.8237C113.457 94.1505 87.2172 90.879 79.6671 86.5598C74.3637 83.5286 71.2543 76.3446 70.952 70.4464C70.7486 66.4653 73.1624 54.5122 71.8717 52.1042L71.8767 52.1114ZM140.936 64.1947C123.428 67.6184 105.534 64.0746 88.4488 59.8422L74.1161 54.5163C75.0939 63.5645 72.7098 76.533 82.262 81.5823C90.5746 85.9797 115.887 89.2073 124.48 84.8877C131.152 81.5357 135.952 69.6885 140.929 64.1936L140.936 64.1947Z',
  'M221.259 66.8037C222.576 67.0184 224.056 68.2149 223.362 69.6863C222.089 72.3764 204.471 77.9277 202.067 76.8087C200.115 75.9033 200.795 74.442 201.984 73.1919C204.463 70.5888 217.772 66.2294 221.259 66.8037Z',
  'M24.1758 15.5548C26.2961 15.4038 31.7172 23.1505 32.9454 25.1218C34.0116 26.823 39.0726 34.7345 36.3299 36.0265C34.4895 36.6084 33.4605 35.0917 32.3533 33.9804C30.0308 31.6498 22.1894 20.0431 22.4832 17.0968L24.1758 15.5548Z',
  'M217.242 47.376C221.315 47.3745 220.804 49.7868 218.446 52.1382C216.684 53.8902 204.389 61.1422 201.994 61.8733C200.877 62.2151 199.658 62.634 198.678 61.6979C197.709 60.5603 198.367 60.5818 199.007 59.8821C203.7 54.8069 211.585 51.359 217.242 47.376Z',
  'M39.1174 2.60413C40.8711 1.43514 42.6084 9.43024 42.8427 10.2977C44.2672 15.5373 44.8231 21.0104 46.672 26.1538L45.4579 27.9395C42.505 28.2286 40.425 20.9097 39.8883 18.699C39.3071 16.3088 37.3783 3.76299 39.1247 2.59907L39.1174 2.60413Z',
  'M119.788 101.608C123.18 101.428 129.578 105.784 131.153 108.776C136.196 118.336 125.07 129.538 115.911 123.097C108.484 117.872 111.362 102.05 119.788 101.608ZM120.381 105.404C114.458 105.471 113.125 120.474 121.054 120.865C125.363 121.077 128.033 116.57 127.84 112.674C127.704 109.892 123.007 105.381 120.38 105.41L120.381 105.404Z',
  'M82.9149 105.692C88.7848 115.679 74.1155 125.158 67.4083 116.771C62.6132 110.768 67.7557 97.8884 75.1282 99.7303C76.8706 100.167 82.0351 104.196 82.9149 105.692ZM73.9567 102.889C69.8131 102.179 65.9554 112.803 71.3609 115.617C76.3884 118.231 82.3054 112.426 78.5674 106.884C77.9982 106.04 74.7834 103.036 73.9567 102.889Z',
  'M163.058 71.9891C173.189 71.7287 168.373 86.2476 159.023 81.4247C154.044 78.8577 157.445 72.1365 163.058 71.9891ZM164.408 75.818L160.757 75.8816L160.254 78.1809L163.354 78.4579L164.409 75.8118L164.408 75.818Z',
  'M43.8754 95.9504C42.1671 89.5486 44.2168 86.4247 50.8452 86.1843C54.9626 86.0383 56.6414 87.2637 55.7529 91.6609C54.5279 97.7391 48.6682 97.3409 43.8754 95.9504ZM52.9547 89.6079L44.9936 88.8241L44.6353 94.3573L51.552 94.0346L52.9547 89.6079Z',
  'M150.77 81.5994L151.742 82.2547C153.457 87.4378 149.78 95.1073 143.813 90.9738C141.665 89.4873 142.282 85.3278 143.588 83.4567C144.985 81.4622 148.644 81.7874 150.77 81.5994ZM149.094 84.9166C146.403 84.1595 145.441 86.2441 145.336 88.595C148.027 89.352 148.988 87.2674 149.094 84.9166Z',
  'M160.607 96.9524C160.885 97.2115 161.171 101.41 160.999 102.238C160.024 106.943 156.258 108.873 151.845 107.029C145.649 104.437 153 92.7755 157.663 99.8096C147.153 99.6535 154.344 109.868 157.521 102.618C158.353 100.726 158.29 94.8069 160.613 96.9535L160.607 96.9524Z',
  'M170.587 95.9665C166.478 98.8266 160.872 95.316 162.509 90.1432C162.742 89.4032 165.439 86.2862 165.821 86.1443C169.151 84.912 176.461 91.8758 170.587 95.9665ZM166.791 88.7113C165.282 89.6125 164.145 91.3928 165.036 93.0756C166.914 96.6233 171.778 91.229 166.791 88.7113Z',
  'M42.2826 85.7065C41.1051 86.5331 33.5461 86.818 32.4214 85.6973C31.3936 84.6763 32.9807 79.1389 34.1202 78.2039C36.1228 76.5645 43.8444 76.7976 43.9037 80.8739C43.9185 82.0454 43.24 85.0442 42.2826 85.7065ZM40.7352 80.6928L35.3254 79.9107L34.0551 83.7701C36.3588 84.5219 38.6005 83.9732 40.9001 83.7079L40.7414 80.6939L40.7352 80.6928Z',
  'M44.3664 75.0037C44.8344 71.5419 45.5409 64.584 50.3126 65.0178C55.6976 65.5097 56.0808 76.2947 49.8389 76.5084C47.7833 76.582 46.2762 75.3934 44.3675 74.9975L44.3664 75.0037ZM45.7545 74.0303C52.5509 76.6085 53.8899 66.6246 49.2278 67.2584C47.5394 67.4861 45.9509 72.3499 45.7545 74.0303Z',
  'M56.482 84.5036C56.3179 81.9143 56.1873 79.6741 57.6249 77.3817C59.3993 78.4272 58.071 80.6055 58.0195 82.1147C57.9564 84.1554 62.899 84.0923 64.2001 83.5735C65.2953 83.139 65.9353 80.6797 65.8758 79.5447C64.0851 78.0898 61.7031 78.3532 59.7151 77.759C58.833 77.4945 57.9519 76.9379 59.0348 76.3931C61.9357 76.8634 67.6778 75.6653 67.7125 80.1311C67.757 86.263 60.7617 87.423 56.482 84.5036Z',
  'M105.097 108.199L104.12 110.192C101.301 110.734 91.6363 110.01 91.7449 106.135C91.7783 104.978 92.2536 105.24 93.1609 105.147C97.2927 104.705 101.321 106.926 105.104 108.2L105.097 108.199Z',
  'M65.1111 63.1652C62.4874 64.3958 61.8851 52.3713 63.4269 51.6792C66.6295 50.2337 67.1892 61.4948 65.1111 63.1652Z',
  'M148.446 67.4079C149.397 68.3262 146.258 74.935 143.731 73.1143C141.203 71.2936 146.46 65.4798 148.446 67.4079Z',
  'M101.402 115.002L100.708 116.797C88.5366 117.293 91.8288 111.111 101.402 115.002Z',
] as const

interface GameProps {
  className?: string
}

/**
 * Game chalk icon with MorphSVG hover morph.
 * Uses unified viewBox 0 0 230 180 so the image won't crop during morph.
 */
function Game({ className }: GameProps) {
  const wrapperRef = useRef<HTMLDivElement>(null)
  const svgRef = useRef<SVGSVGElement>(null)
  const tweensRef = useRef<gsap.core.Tween[]>([])

  const morphToFinal = useCallback(() => {
    const wrapper = wrapperRef.current
    const svg = svgRef.current
    if (!wrapper || !svg) return

    tweensRef.current.forEach((t) => t.kill())
    tweensRef.current = []

    tweensRef.current.push(
      gsap.to(svg, {
        duration: 0.5,
        ease: 'power2.inOut',
        attr: { viewBox: VIEWBOX_FINAL },
      })
    )

    const paths = wrapper.querySelectorAll<SVGPathElement>('[data-game-path]')
    paths.forEach((path, i) => {
      const targetPath = FINAL_PATHS[Math.min(i, FINAL_PATHS.length - 1)]
      tweensRef.current.push(
        gsap.to(path, {
          duration: 0.5,
          ease: 'power2.inOut',
          morphSVG: { shape: targetPath },
          fill: '#321000',
        })
      )
    })
  }, [])

  const morphToOriginal = useCallback(() => {
    const wrapper = wrapperRef.current
    const svg = svgRef.current
    if (!wrapper || !svg) return

    tweensRef.current.forEach((t) => t.kill())
    tweensRef.current = []

    tweensRef.current.push(
      gsap.to(svg, {
        duration: 0.5,
        ease: 'power2.inOut',
        attr: { viewBox: VIEWBOX_INITIAL },
      })
    )

    const paths = wrapper.querySelectorAll<SVGPathElement>('[data-game-path]')
    paths.forEach((path, i) => {
      const dataOriginal = path.getAttribute('data-original')
      const origPath = dataOriginal ?? ORIGINAL_PATHS[Math.min(i, ORIGINAL_PATHS.length - 1)]
      tweensRef.current.push(
        gsap.to(path, {
          duration: 0.5,
          ease: 'power2.inOut',
          morphSVG: { shape: origPath },
          fill: '#FAF3E7',
        })
      )
    })
  }, [])

  return (
    <div
      ref={wrapperRef}
      className={cn('relative cursor-pointer', className)}
      onMouseEnter={morphToFinal}
      onMouseLeave={morphToOriginal}
      role="presentation"
    >
      <svg
        ref={svgRef}
        width="230"
        height="180"
        viewBox={VIEWBOX_INITIAL}
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        className="block h-auto w-full max-w-[125px] object-contain object-top-left"
        preserveAspectRatio="xMinYMin meet"
        aria-hidden
      >
        <g>
          {ORIGINAL_PATHS.map((d, i) => (
            <path
              key={i}
              data-game-path
              data-original={d}
              d={d}
              fill="#FAF3E7"
            />
          ))}
        </g>
      </svg>
    </div>
  )
}

export default Game
